{"ast":null,"code":"var _jsxFileName = \"/Users/macbookair/PycharmProjects/TicTacToe/client/src/pages/Game.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Row, Col, message } from 'antd';\nimport { Center } from \"../hoc/Center\";\nimport { useParams } from \"react-router-dom\";\nimport { socketio } from \"../socket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]];\n\nconst Game = () => {\n  _s();\n\n  const [currentGame, setCurr] = useState({});\n  const [user, setUser] = useState({});\n  const [start, setStart] = useState(false);\n  const [numHover, setNumHover] = useState(null);\n  const {\n    id\n  } = useParams();\n  const ref = useRef([]);\n  useEffect(() => {\n    socketio.emit('detail_game', id, game => {\n      var _game$players$find;\n\n      setCurr(game);\n      const user = (_game$players$find = game.players.find(x => x.name === localStorage.getItem('username'))) !== null && _game$players$find !== void 0 ? _game$players$find : false;\n\n      if (!user) {\n        const data = {\n          username: localStorage.getItem('username'),\n          game_id: game.id\n        };\n        socketio.emit('join_to_game', data, d => {\n          setCurr(d);\n        });\n      }\n    });\n    socketio.on('start_or_finish_game', d => {\n      setStart(d);\n    });\n    socketio.on('set_user_data', d => {\n      setUser({ ...d\n      });\n    });\n    socketio.on('set_figure', d => {\n      ref.current[+d.cell].innerText = d.figure;\n    });\n    socketio.on('block_step', data => {\n      setUser({ ...data,\n        allow_move: false\n      });\n    });\n    socketio.on('allow_step', data => {\n      setUser({ ...data,\n        allow_move: true\n      });\n    });\n    socketio.on('win', () => {\n      console.log('=====');\n      message.success('You win');\n    });\n    socketio.on('loss', () => {\n      message.error('You loss');\n    });\n    socketio.on('draw', () => {\n      message.warning('Draw');\n    });\n    return () => {};\n  }, [id]);\n  console.log(user);\n\n  const hovering = (e, id) => {\n    if (!start || !user.allow_move) return;\n    const target = e.target;\n    const hoveredCell = target.innerText;\n\n    if (hoveredCell !== '') {\n      setNumHover({\n        num: id,\n        error: true\n      });\n    } else {\n      setNumHover({\n        num: id,\n        error: false\n      });\n    }\n  };\n\n  const setFigure = e => {\n    if (!start || !user.allow_move) return;\n    const d = {\n      figure: user.figure,\n      cell: e.target.id,\n      game_id: currentGame.id\n    };\n    socketio.emit('step', d);\n  };\n\n  const resetNumHover = () => setNumHover(null);\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Center, {\n      children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this), (currentGame === null || currentGame === void 0 ? void 0 : currentGame.players) && (currentGame === null || currentGame === void 0 ? void 0 : currentGame.players[0].name), \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 74\n      }, this), !start ? \"Гра заблокована\" : \"Можна грати\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }, this), matrix.map(e => /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(Row, {\n          children: e.map(i => /*#__PURE__*/_jsxDEV(Col, {\n            ref: element => {\n              ref.current[i] = element;\n            },\n            id: String(i),\n            span: 8,\n            onMouseEnter: e => hovering(e, i),\n            onClick: setFigure,\n            onMouseLeave: resetNumHover,\n            className: !start ? \"game-disable\" : (numHover === null || numHover === void 0 ? void 0 : numHover.num) === i ? numHover.error ? 'cell-error' : 'cell-hover' : 'cell'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 37\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 29\n        }, this)\n      }, void 0, false))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n};\n\n_s(Game, \"Q5NQYEOttr8M8BW2yfRQd1G+oWw=\", false, function () {\n  return [useParams];\n});\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Row","Col","message","Center","useParams","socketio","matrix","Game","currentGame","setCurr","user","setUser","start","setStart","numHover","setNumHover","id","ref","emit","game","players","find","x","name","localStorage","getItem","data","username","game_id","d","on","current","cell","innerText","figure","allow_move","console","log","success","error","warning","hovering","e","target","hoveredCell","num","setFigure","resetNumHover","map","i","element","String"],"sources":["/Users/macbookair/PycharmProjects/TicTacToe/client/src/pages/Game.tsx"],"sourcesContent":["import React, { useState, MouseEvent, useEffect, useRef, FC } from 'react';\n\nimport { Row, Col, message } from 'antd';\nimport { Center } from \"../hoc/Center\";\nimport { useParams } from \"react-router-dom\";\nimport {socketio} from \"../socket\";\nimport {Creator, Game as GameType} from '../types'\n\n\nconst matrix = [\n    [1, 2, 3],\n    [4, 5, 6],\n    [7, 8, 9]\n]\n\ninterface INum{\n    num: number,\n    error: boolean\n}\n\ninterface JoinToGameValues{\n    username: string,\n    game_id: string\n}\n\nconst Game: FC = () => {\n\n    const [currentGame, setCurr] = useState<GameType>({} as GameType)\n\n    const [user, setUser] = useState<Creator>({} as Creator)\n    const [start, setStart] = useState<boolean>(false)\n\n    const [numHover, setNumHover] = useState<INum | null>(null)\n\n    const { id } = useParams()\n\n    const ref = useRef<HTMLDivElement[]>([])\n\n    useEffect(() =>{\n        socketio.emit('detail_game', id, (game: GameType) => {\n            setCurr(game)\n            const user = game.players.find(x => x.name === localStorage.getItem('username')) ?? false\n\n            if (!user){\n                const data: JoinToGameValues = {\n                    username: localStorage.getItem('username')!,\n                    game_id: game.id\n                }\n\n                socketio.emit('join_to_game', data, (d: any) =>{\n                    setCurr(d)\n                })\n            }\n        })\n\n        socketio.on('start_or_finish_game', (d: any) =>{\n            setStart(d)\n        })\n\n        socketio.on('set_user_data', (d: any) =>{\n            setUser({...d})\n        })\n\n        socketio.on('set_figure', (d: any) =>{\n            ref.current[+d.cell].innerText = d.figure\n        })\n\n        socketio.on('block_step', (data: any) =>{\n            setUser( {...data, allow_move: false})\n        })\n\n        socketio.on('allow_step', (data: any) =>{\n            setUser( {...data, allow_move: true})\n        })\n\n        socketio.on('win', () =>{\n            console.log('=====')\n            message.success('You win');\n        })\n\n        socketio.on('loss', () =>{\n            message.error('You loss');\n        })\n\n        socketio.on('draw', () =>{\n            message.warning('Draw');\n        })\n\n        return () => {}\n\n    }, [id])\n\n    console.log(user)\n\n    const hovering = (e: MouseEvent<HTMLDivElement>, id: number) => {\n        if (!start || !user.allow_move) return\n\n        const target = e.target as HTMLDivElement\n        const hoveredCell = target.innerText\n\n        if (hoveredCell !== ''){\n            setNumHover({\n                num: id,\n                error: true\n            })\n        }else{\n            setNumHover({\n                num: id,\n                error: false\n            })\n        }\n    }\n\n    const setFigure = (e: any) =>{\n        if (!start || !user.allow_move) return\n\n        const d = {\n            figure: user.figure,\n            cell: e.target.id,\n            game_id: currentGame.id\n        }\n\n        socketio.emit('step', d)\n    }\n\n    const resetNumHover = () => setNumHover(null)\n\n    return (\n        <>\n            <Center>\n                <br/>\n                <br/>\n                { currentGame?.players && currentGame?.players[0].name } <br/>\n                { !start ? \"Гра заблокована\": \"Можна грати\" }\n                <br/>\n                <br/>\n                {\n                    matrix.map(e => (\n                        <>\n                            <Row>\n                                {e.map(i =>(\n                                    <Col\n                                        ref={(element: any) => {\n                                            ref.current[i] = element;\n                                        }}\n                                        id={String(i)}\n                                        span={8}\n                                        onMouseEnter={(e) => hovering(e, i)}\n                                        onClick={setFigure}\n                                        onMouseLeave={resetNumHover}\n                                        className={\n                                            !start\n                                                ? \"game-disable\"\n                                                :\n                                                numHover?.num === i\n                                                    ?\n                                                    numHover.error\n                                                        ? 'cell-error'\n                                                        :\n                                                        'cell-hover'\n                                                    :\n                                                    'cell'\n                                        }\n                                    ></Col>\n                                ))}\n                            </Row>\n                        </>\n                    ))\n                }\n            </Center>\n        </>\n    );\n}\n\nexport default Game;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}